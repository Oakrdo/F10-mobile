-- Auto Farm Tennenman com Teleport - Dragon Ball Rage
-- Por: DeepSeek-R1

wait(2)

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- Vari√°veis
local player = Players.LocalPlayer
local character = player.Character
local humanoid = character and character:WaitForChild("Humanoid")
local rootPart = character and character:WaitForChild("HumanoidRootPart")

-- Configura√ß√µes
local FARM_RANGE = 500
local ATTACK_RANGE = 15
local TELEPORT_OFFSET = 3
local ATTACK_DELAY = 0.5
local IS_FARMING = false
local currentTarget = nil
local tennenmanNPCs = {}

-- Criar GUI que n√£o reseta
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TennenmanFarm"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false  -- Isso impede que o menu suma ao morrer

-- Frame principal
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0.5, 0, 0.22, 0)
mainFrame.Position = UDim2.new(0.05, 0, 0.7, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 30, 30)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- T√≠tulo
local title = Instance.new("TextLabel")
title.Text = "üêâ AUTO FARM TENNENMAN"
title.Size = UDim2.new(1, 0, 0.18, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)
title.TextScaled = true
title.Font = Enum.Font.SourceSansBold
title.Parent = mainFrame

-- Status
local statusLabel = Instance.new("TextLabel")
statusLabel.Text = "üî¥ PARADO"
statusLabel.Size = UDim2.new(1, 0, 0.18, 0)
statusLabel.Position = UDim2.new(0, 0, 0.18, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1, 0.5, 0.5)
statusLabel.TextScaled = true
statusLabel.Parent = mainFrame

-- Info
local infoLabel = Instance.new("TextLabel")
infoLabel.Text = "NPCs: 0 | Alvo: Nenhum"
infoLabel.Size = UDim2.new(1, 0, 0.18, 0)
infoLabel.Position = UDim2.new(0, 0, 0.36, 0)
infoLabel.BackgroundTransparency = 1
infoLabel.TextColor3 = Color3.new(0.8, 0.8, 1)
infoLabel.TextScaled = true
infoLabel.Parent = mainFrame

-- Bot√µes
local buttonFrame = Instance.new("Frame")
buttonFrame.Size = UDim2.new(1, 0, 0.46, 0)
buttonFrame.Position = UDim2.new(0, 0, 0.54, 0)
buttonFrame.BackgroundTransparency = 1
buttonFrame.Parent = mainFrame

-- Bot√£o Iniciar/Parar
local toggleButton = Instance.new("TextButton")
toggleButton.Text = "‚ñ∂ INICIAR"
toggleButton.Size = UDim2.new(0.48, 0, 0.9, 0)
toggleButton.Position = UDim2.new(0.01, 0, 0.05, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.TextScaled = true
toggleButton.Parent = buttonFrame

-- Bot√£o Procurar NPCs
local searchButton = Instance.new("TextButton")
searchButton.Text = "üîç ATUALIZAR"
searchButton.Size = UDim2.new(0.48, 0, 0.9, 0)
searchButton.Position = UDim2.new(0.51, 0, 0.05, 0)
searchButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
searchButton.TextColor3 = Color3.new(1, 1, 1)
searchButton.TextScaled = true
searchButton.Parent = buttonFrame

-- Fun√ß√£o para atualizar refer√™ncias do personagem
local function updateCharacterReferences()
    character = player.Character
    if character then
        humanoid = character:WaitForChild("Humanoid")
        rootPart = character:WaitForChild("HumanoidRootPart")
        print("‚úÖ Personagem atualizado ap√≥s respawn")
    end
end

-- Fun√ß√£o para encontrar NPCs Tennenman
local function findTennenmanNPCs()
    tennenmanNPCs = {}
    
    -- Atualizar refer√™ncias do personagem
    updateCharacterReferences()
    
    if not character or not rootPart then
        infoLabel.Text = "‚ùå Personagem n√£o carregado"
        return 0
    end
    
    -- Procurar na estrutura correta: Map ‚Üí NPCs ‚Üí Tennenman
    local mapFolder = Workspace:FindFirstChild("Map")
    if not mapFolder then
        infoLabel.Text = "‚ùå Pasta Map n√£o encontrada"
        return 0
    end
    
    local npcsFolder = mapFolder:FindFirstChild("NPCs")
    if not npcsFolder then
        infoLabel.Text = "‚ùå Pasta NPCs n√£o encontrada"
        return 0
    end
    
    -- Procurar pelo model "Tennenman"
    local tennenmanModel = npcsFolder:FindFirstChild("Tennenman")
    if not tennenmanModel then
        infoLabel.Text = "‚ùå Tennenman n√£o encontrado"
        return 0
    end
    
    -- Procurar por HumanoidRootPart
    local rootPartTennenman = tennenmanModel:FindFirstChild("HumanoidRootPart")
    if not rootPartTennenman then
        infoLabel.Text = "‚ùå HumanoidRootPart n√£o encontrado"
        return 0
    end
    
    -- Verificar se tem Humanoid
    local humanoidTennenman = tennenmanModel:FindFirstChildOfClass("Humanoid")
    if not humanoidTennenman then
        infoLabel.Text = "‚ùå Humanoid n√£o encontrado"
        return 0
    end
    
    -- Verificar se est√° vivo
    if humanoidTennenman.Health <= 0 then
        infoLabel.Text = "üíÄ Tennenman morto"
        return 0
    end
    
    -- Calcular dist√¢ncia
    local distance = (rootPartTennenman.Position - rootPart.Position).Magnitude
    
    -- Sempre adicionar, independente da dist√¢ncia
    table.insert(tennenmanNPCs, {
        Model = tennenmanModel,
        RootPart = rootPartTennenman,
        Humanoid = humanoidTennenman,
        Position = rootPartTennenman.Position,
        Distance = distance
    })
    
    infoLabel.Text = "NPCs: 1 | Dist: " .. math.floor(distance)
    print("üìç Dist√¢ncia real: " .. math.floor(distance) .. " studs")
    
    return 1
end

-- Fun√ß√£o para teleportar na FRENTE do NPC
local function teleportToFront(targetPosition, targetRootPart)
    if not rootPart or not targetRootPart then 
        updateCharacterReferences()
        if not rootPart then return end
    end
    
    -- Calcular dire√ß√£o do NPC
    local npcLookVector = targetRootPart.CFrame.LookVector
    local positionInFront = targetPosition + (npcLookVector * -ATTACK_RANGE) + Vector3.new(0, TELEPORT_OFFSET, 0)
    
    -- Criar CFrame olhando para o NPC
    local lookAtCFrame = CFrame.new(positionInFront, targetPosition)
    rootPart.CFrame = lookAtCFrame
    
    print("üöÄ Teleportado para FRENTE do NPC")
end

-- Fun√ß√£o para simular ataque
local function performAttack()
    -- Pequeno delay antes do ataque
    wait(0.1)
    
    -- Tecla E (PC)
    pcall(function()
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
        wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
    end)
    
    -- Bot√£o Combat (Mobile)
    pcall(function()
        for _, gui in pairs(player.PlayerGui:GetDescendants()) do
            if gui:IsA("TextButton") and (
                string.find(gui.Name:lower(), "combat") or
                string.find(gui.Name:lower(), "attack") or
                gui.Name == "Combat" or
                gui.Name == "Attack"
            ) then
                gui:FireEvent("MouseButton1Click")
                break
            end
        end
    end)
end

-- Fun√ß√£o para verificar se o alvo ainda existe e est√° vivo
local function isTargetValid(target)
    if not target or not target.Model then return false end
    if not target.Model.Parent then return false end
    
    local humanoid = target.Model:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    
    return true
end

-- Fun√ß√£o principal de farm
local function farmLoop()
    while IS_FARMING do
        -- Atualizar refer√™ncias do personagem a cada ciclo
        updateCharacterReferences()
        
        if not character or not rootPart then
            statusLabel.Text = "üü° AGUARDANDO RESPAWN..."
            statusLabel.TextColor3 = Color3.new(1, 1, 0.5)
            wait(1)
            continue
        end
        
        -- Buscar NPCs
        local found = findTennenmanNPCs()
        
        if found > 0 then
            currentTarget = tennenmanNPCs[1]
            
            if isTargetValid(currentTarget) then
                statusLabel.Text = "üü¢ ATACANDO TENNENMAN"
                statusLabel.TextColor3 = Color3.new(0.5, 1, 0.5)
                infoLabel.Text = "NPCs: " .. found .. " | Sa√∫de: " .. math.floor(currentTarget.Humanoid.Health)
                
                -- Teleportar para FRENTE do Tennenman
                teleportToFront(currentTarget.Position, currentTarget.RootPart)
                wait(0.2)
                
                -- Atacar
                performAttack()
                
                -- Virar para o alvo
                if rootPart and currentTarget.Position then
                    rootPart.CFrame = CFrame.new(rootPart.Position, currentTarget.Position)
                end
                
                wait(ATTACK_DELAY)
                
            else
                -- Tennenman morreu
                statusLabel.Text = "üü° TENNENMAN MORREU"
                statusLabel.TextColor3 = Color3.new(1, 1, 0.5)
                tennenmanNPCs = {}
                wait(3)
            end
            
        else
            statusLabel.Text = "üü° PROCURANDO TENNENMAN..."
            statusLabel.TextColor3 = Color3.new(1, 1, 0.5)
            wait(1)
        end
        
        RunService.Heartbeat:Wait()
    end
end

-- Conectar bot√µes
toggleButton.MouseButton1Click:Connect(function()
    IS_FARMING = not IS_FARMING
    
    if IS_FARMING then
        toggleButton.Text = "‚èπ PARAR"
        toggleButton.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
        statusLabel.Text = "üü¢ INICIANDO..."
        statusLabel.TextColor3 = Color3.new(0.5, 1, 0.5)
        
        -- Iniciar loop de farm em thread separada
        spawn(farmLoop)
        
    else
        toggleButton.Text = "‚ñ∂ INICIAR"
        toggleButton.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
        statusLabel.Text = "üî¥ PARADO"
        statusLabel.TextColor3 = Color3.new(1, 0.5, 0.5)
        currentTarget = nil
        tennenmanNPCs = {}
    end
end)

searchButton.MouseButton1Click:Connect(function()
    local count = findTennenmanNPCs()
    statusLabel.Text = "üîç ENCONTRADOS: " .. count
    statusLabel.TextColor3 = Color3.new(0.8, 0.8, 1)
    wait(2)
    if not IS_FARMING then
        statusLabel.Text = "üî¥ PARADO"
        statusLabel.TextColor3 = Color3.new(1, 0.5, 0.5)
    end
end)

-- Sistema de respawn autom√°tico
player.CharacterAdded:Connect(function(newChar)
    print("üéÆ Personagem respawnou - atualizando refer√™ncias...")
    
    -- Pequeno delay para garantir que o personagem est√° totalmente carregado
    wait(1)
    
    -- Atualizar refer√™ncias
    updateCharacterReferences()
    
    -- Se estava farmando, continuar automaticamente
    if IS_FARMING then
        statusLabel.Text = "üü¢ RETOMANDO FARM..."
        statusLabel.TextColor3 = Color3.new(0.5, 1, 0.5)
        wait(2)  -- Esperar um pouco mais ap√≥s respawn
        spawn(farmLoop)
    end
end)

-- Inicializa√ß√£o
print("üêâ Auto Farm Tennenman carregado!")
print("‚úÖ Menu configurado para N√ÉO desaparecer ao morrer")
print("‚úÖ Sistema de respawn autom√°tico ativado")
findTennenmanNPCs()

print("‚ñ∂ INICIAR - Come√ßa o farm autom√°tico")
print("üîç ATUALIZAR - Atualiza lista de NPCs")
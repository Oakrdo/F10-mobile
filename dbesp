-- ESP para Esferas do Drag√£o + Hop Server + Auto Execute
-- Por: DeepSeek-R1

wait(2)

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

-- Vari√°veis
local player = Players.LocalPlayer
local IS_ESP_ACTIVE = false
local dragonBalls = {}
local espHandles = {}
local currentTPIndex = 1
local placeId = game.PlaceId

-- Criar GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DragonBallESP"
screenGui.Parent = CoreGui
screenGui.ResetOnSpawn = false

-- Frame principal
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0.45, 0, 0.3, 0)
mainFrame.Position = UDim2.new(0.05, 0, 0.1, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 30, 30)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- T√≠tulo
local title = Instance.new("TextLabel")
title.Text = "üåü ESP ESFERAS + HOP SERVER"
title.Size = UDim2.new(1, 0, 0.15, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)
title.TextScaled = true
title.Font = Enum.Font.SourceSansBold
title.Parent = mainFrame

-- Status
local statusLabel = Instance.new("TextLabel")
statusLabel.Text = "üî¥ ESP DESLIGADO"
statusLabel.Size = UDim2.new(1, 0, 0.15, 0)
statusLabel.Position = UDim2.new(0, 0, 0.15, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1, 0.5, 0.5)
statusLabel.TextScaled = true
statusLabel.Parent = mainFrame

-- Info
local infoLabel = Instance.new("TextLabel")
infoLabel.Text = "Esferas: 0 | TP: 0/0"
infoLabel.Size = UDim2.new(1, 0, 0.15, 0)
infoLabel.Position = UDim2.new(0, 0, 0.3, 0)
infoLabel.BackgroundTransparency = 1
infoLabel.TextColor3 = Color3.new(0.8, 0.8, 1)
infoLabel.TextScaled = true
infoLabel.Parent = mainFrame

-- Server Info
local serverLabel = Instance.new("TextLabel")
serverLabel.Text = "Server: " .. game.JobId
serverLabel.Size = UDim2.new(1, 0, 0.15, 0)
serverLabel.Position = UDim2.new(0, 0, 0.45, 0)
serverLabel.BackgroundTransparency = 1
serverLabel.TextColor3 = Color3.new(1, 1, 0.5)
serverLabel.TextScaled = true
serverLabel.Parent = mainFrame

-- Bot√µes
local buttonFrame = Instance.new("Frame")
buttonFrame.Size = UDim2.new(1, 0, 0.4, 0)
buttonFrame.Position = UDim2.new(0, 0, 0.6, 0)
buttonFrame.BackgroundTransparency = 1
buttonFrame.Parent = mainFrame

-- Bot√£o ESP
local espButton = Instance.new("TextButton")
espButton.Text = "üåü LIGAR ESP"
espButton.Size = UDim2.new(0.48, 0, 0.4, 0)
espButton.Position = UDim2.new(0.01, 0, 0.05, 0)
espButton.BackgroundColor3 = Color3.fromRGB(180, 80, 180)
espButton.TextColor3 = Color3.new(1, 1, 1)
espButton.TextScaled = true
espButton.Parent = buttonFrame

-- Bot√£o TP para Esfera
local tpButton = Instance.new("TextButton")
tpButton.Text = "üöÄ TP PR√ìXIMA"
tpButton.Size = UDim2.new(0.48, 0, 0.4, 0)
tpButton.Position = UDim2.new(0.51, 0, 0.05, 0)
tpButton.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
tpButton.TextColor3 = Color3.new(1, 1, 1)
tpButton.TextScaled = true
tpButton.Parent = buttonFrame

-- Bot√£o Hop Server
local hopButton = Instance.new("TextButton")
hopButton.Text = "üîÑ HOP SERVER"
hopButton.Size = UDim2.new(0.48, 0, 0.4, 0)
hopButton.Position = UDim2.new(0.01, 0, 0.55, 0)
hopButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
hopButton.TextColor3 = Color3.new(1, 1, 1)
hopButton.TextScaled = true
hopButton.Parent = buttonFrame

-- Bot√£o Auto Execute
local autoButton = Instance.new("TextButton")
autoButton.Text = "‚ö° AUTO ON"
autoButton.Size = UDim2.new(0.48, 0, 0.4, 0)
autoButton.Position = UDim2.new(0.51, 0, 0.55, 0)
autoButton.BackgroundColor3 = Color3.fromRGB(200, 120, 80)
autoButton.TextColor3 = Color3.new(1, 1, 1)
autoButton.TextScaled = true
autoButton.Parent = buttonFrame

-- Vari√°veis do Auto Execute
local AUTO_EXECUTE = false
local lastHopTime = 0
local hopCooldown = 10 -- segundos

-- Fun√ß√£o MELHORADA para verificar se √© uma Esfera do Drag√£o
local function isDragonBall(model)
    local name = tostring(model.Name)
    
    -- Verifica se √© um GUID (come√ßa com { e termina com })
    if string.sub(name, 1, 1) == "{" and string.sub(name, -1) == "}" then
        return true
    end
    
    -- Ignora nomes que sabemos que n√£o s√£o esferas
    local lowerName = string.lower(name)
    if string.find(lowerName, "dragonshop") or 
       string.find(lowerName, "explainer") or 
       string.find(lowerName, "spawn") or
       string.find(lowerName, "giver") or
       string.find(lowerName, "npc") then
        return false
    end
    
    return false
end

-- Fun√ß√£o MELHORADA para criar ESP de uma Esfera do Drag√£o
local function createDragonBallESP(dragonBall)
    if espHandles[dragonBall] then return end
    
    -- Encontrar uma parte para ancorar o ESP
    local rootPart = dragonBall:FindFirstChild("HumanoidRootPart") or 
                    dragonBall:FindFirstChild("Head") or 
                    dragonBall:FindFirstChild("Torso") or 
                    dragonBall:FindFirstChild("Part") or
                    dragonBall:FindFirstChildWhichIsA("Part")
    
    if not rootPart then
        -- Se n√£o encontrar parte espec√≠fica, usa o pr√≥prio modelo
        rootPart = dragonBall
    end
    
    -- BillboardGui para texto flutuante MAIOR
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "DragonBallESP"
    billboard.Adornee = rootPart
    billboard.Size = UDim2.new(0, 400, 0, 100)
    billboard.StudsOffset = Vector3.new(0, 5, 0)
    billboard.AlwaysOnTop = true
    billboard.MaxDistance = 5000
    billboard.ExtentsOffset = Vector3.new(0, 0, 0)
    billboard.Parent = rootPart
    
    -- Texto da esfera MAIOR
    local textLabel = Instance.new("TextLabel")
    textLabel.Text = "üåü ESFERA DO DRAG√ÉO üåü"
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.new(1, 1, 0)
    textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    textLabel.TextStrokeTransparency = 0
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextSize = 50
    textLabel.Parent = billboard
    
    -- Highlight MAIS BRILHANTE
    local highlight = Instance.new("Highlight")
    highlight.Name = "DragonBallHighlight"
    highlight.Adornee = dragonBall
    highlight.FillColor = Color3.new(1, 1, 0)
    highlight.OutlineColor = Color3.new(1, 0.3, 0)
    highlight.FillTransparency = 0.2
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = dragonBall
    
    espHandles[dragonBall] = {
        Billboard = billboard,
        Highlight = highlight
    }
end

-- Fun√ß√£o para remover ESP de uma Esfera
local function removeDragonBallESP(dragonBall)
    if espHandles[dragonBall] then
        if espHandles[dragonBall].Billboard then
            espHandles[dragonBall].Billboard:Destroy()
        end
        if espHandles[dragonBall].Highlight then
            espHandles[dragonBall].Highlight:Destroy()
        end
        espHandles[dragonBall] = nil
    end
end

-- Fun√ß√£o para limpar todos os ESPs
local function clearAllESP()
    for dragonBall, handles in pairs(espHandles) do
        removeDragonBallESP(dragonBall)
    end
    espHandles = {}
end

-- Fun√ß√£o MELHORADA para encontrar Esferas do Drag√£o
local function findDragonBalls()
    dragonBalls = {}
    
    -- Busca ESPEC√çFICA no caminho Map
    local mapFolder = Workspace:FindFirstChild("Map")
    if mapFolder then
        -- Procura por TODOS os modelos no Map
        for _, obj in pairs(mapFolder:GetDescendants()) do
            if obj:IsA("Model") and isDragonBall(obj) then
                local rootPartBall = obj:FindFirstChild("HumanoidRootPart") or 
                                   obj:FindFirstChild("Head") or 
                                   obj:FindFirstChild("Torso") or 
                                   obj:FindFirstChild("Part") or
                                   obj:FindFirstChildWhichIsA("Part")
                
                local position
                if rootPartBall then
                    position = rootPartBall.Position
                else
                    position = obj:GetPivot().Position
                end
                
                table.insert(dragonBalls, {
                    Model = obj,
                    RootPart = rootPartBall or obj,
                    Position = position,
                    Name = obj.Name
                })
            end
        end
    end
    
    -- Ordenar por dist√¢ncia do player
    local character = player.Character
    if character then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            table.sort(dragonBalls, function(a, b)
                local distA = (a.Position - humanoidRootPart.Position).Magnitude
                local distB = (b.Position - humanoidRootPart.Position).Magnitude
                return distA < distB
            end)
        end
    end
    
    local count = #dragonBalls
    infoLabel.Text = "Esferas: " .. count .. " | TP: " .. currentTPIndex .. "/" .. count
    
    -- Criar/atualizar ESP se estiver ativo
    if IS_ESP_ACTIVE then
        for _, dragonBall in pairs(dragonBalls) do
            createDragonBallESP(dragonBall.Model)
        end
    end
    
    return count
end

-- Fun√ß√£o MELHORADA para Teleportar para a PR√ìXIMA Esfera
local function teleportToNextDragonBall()
    local character = player.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    -- Atualizar lista de esferas
    findDragonBalls()
    
    if #dragonBalls == 0 then
        statusLabel.Text = "‚ùå NENHUMA ESFERA"
        wait(2)
        statusLabel.Text = IS_ESP_ACTIVE and "üü¢ ESP ATIVADO" or "üî¥ ESP DESLIGADO"
        return
    end
    
    -- Avan√ßar para a pr√≥xima esfera (c√≠clico)
    local targetBall = dragonBalls[currentTPIndex]
    
    -- Teleportar para a esfera
    local teleportPosition = targetBall.Position + Vector3.new(0, 5, 0)
    
    -- Usar Tween para teleporte suave
    local tweenInfo = TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = CFrame.new(teleportPosition)})
    tween:Play()
    
    -- Atualizar √≠ndice para a pr√≥xima esfera
    currentTPIndex = currentTPIndex + 1
    if currentTPIndex > #dragonBalls then
        currentTPIndex = 1
    end
    
    statusLabel.Text = "üöÄ TP: " .. (currentTPIndex - 1) .. "/" .. #dragonBalls
    infoLabel.Text = "Esferas: " .. #dragonBalls .. " | TP: " .. currentTPIndex .. "/" .. #dragonBalls
    
    wait(1)
    statusLabel.Text = IS_ESP_ACTIVE and "üü¢ ESP ATIVADO" or "üî¥ ESP DESLIGADO"
end

-- Fun√ß√£o CORRIGIDA para Hop Server
local function hopServer()
    local currentTime = tick()
    if currentTime - lastHopTime < hopCooldown then
        local waitTime = math.floor(hopCooldown - (currentTime - lastHopTime))
        statusLabel.Text = "‚è≥ AGUARDE " .. waitTime .. "s"
        wait(2)
        statusLabel.Text = IS_ESP_ACTIVE and "üü¢ ESP ATIVADO" or "üî¥ ESP DESLIGADO"
        return
    end
    
    lastHopTime = currentTime
    
    statusLabel.Text = "üîÑ HOP SERVER..."
    
    -- M√©todo SIMPLES e FUNCIONAL de Hop
    pcall(function()
        -- Teleportar para o mesmo placeId (isso faz hop autom√°tico)
        TeleportService:Teleport(placeId, player)
    end)
end

-- Fun√ß√£o ALTERNATIVA para Hop Server (m√©todo reserva)
local function alternativeHop()
    statusLabel.Text = "üîÑ HOP ALTERNATIVO..."
    
    pcall(function()
        -- Tentar teleportar para o lobby primeiro
        TeleportService:Teleport(placeId, player)
    end)
end

-- Fun√ß√£o para Auto Hop
local function autoHopLoop()
    while AUTO_EXECUTE do
        -- Verificar se n√£o h√° esferas no server atual
        findDragonBalls()
        
        if #dragonBalls == 0 then
            statusLabel.Text = "üîÑ AUTO HOP - SEM ESFERAS"
            wait(2)
            hopServer()
            wait(15) -- Esperar 15 segundos ap√≥s tentar o hop
        else
            -- Se tem esferas, ativar ESP automaticamente
            if not IS_ESP_ACTIVE then
                IS_ESP_ACTIVE = true
                espButton.Text = "üåü DESLIGAR ESP"
                espButton.BackgroundColor3 = Color3.fromRGB(80, 180, 180)
                statusLabel.Text = "üü¢ AUTO ESP ATIVADO"
                findDragonBalls()
            end
            wait(10) -- Verificar a cada 10 segundos
        end
        
        if not AUTO_EXECUTE then
            break
        end
    end
end

-- Loop do ESP
local function espLoop()
    while IS_ESP_ACTIVE do
        findDragonBalls()
        wait(3)
    end
end

-- Conectar bot√£o ESP
espButton.MouseButton1Click:Connect(function()
    IS_ESP_ACTIVE = not IS_ESP_ACTIVE
    
    if IS_ESP_ACTIVE then
        espButton.Text = "üåü DESLIGAR ESP"
        espButton.BackgroundColor3 = Color3.fromRGB(80, 180, 180)
        statusLabel.Text = "üü¢ ESP ATIVADO"
        
        findDragonBalls()
        coroutine.wrap(espLoop)()
        
    else
        espButton.Text = "üåü LIGAR ESP"
        espButton.BackgroundColor3 = Color3.fromRGB(180, 80, 180)
        statusLabel.Text = "üî¥ ESP DESLIGADO"
        
        clearAllESP()
    end
end)

-- Conectar bot√£o TP
tpButton.MouseButton1Click:Connect(function()
    teleportToNextDragonBall()
end)

-- Conectar bot√£o Hop
hopButton.MouseButton1Click:Connect(function()
    hopServer()
    
    -- Se o hop principal falhar, tentar o alternativo ap√≥s 3 segundos
    delay(3, function()
        if game.JobId == game.JobId then -- Se ainda no mesmo server
            statusLabel.Text = "üîÑ TENTANDO HOP ALTERNATIVO"
            wait(1)
            alternativeHop()
        end
    end)
end)

-- Conectar bot√£o Auto Execute
autoButton.MouseButton1Click:Connect(function()
    AUTO_EXECUTE = not AUTO_EXECUTE
    
    if AUTO_EXECUTE then
        autoButton.Text = "‚ö° AUTO OFF"
        autoButton.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
        statusLabel.Text = "üü¢ AUTO EXECUTE ON"
        
        -- Ativar ESP automaticamente
        if not IS_ESP_ACTIVE then
            IS_ESP_ACTIVE = true
            espButton.Text = "üåü DESLIGAR ESP"
            espButton.BackgroundColor3 = Color3.fromRGB(80, 180, 180)
            findDragonBalls()
        end
        
        coroutine.wrap(autoHopLoop)()
        
    else
        autoButton.Text = "‚ö° AUTO ON"
        autoButton.BackgroundColor3 = Color3.fromRGB(200, 120, 80)
        statusLabel.Text = "üî¥ AUTO EXECUTE OFF"
    end
end)

-- Atualizar ESP quando novos objetos forem adicionados
local function onDescendantAdded(descendant)
    if IS_ESP_ACTIVE and descendant:IsA("Model") and isDragonBall(descendant) then
        wait(0.5)
        findDragonBalls()
    end
end

-- Conectar aos eventos
Workspace.DescendantAdded:Connect(onDescendantAdded)

-- Atualizar informa√ß√µes do servidor
local function updateServerInfo()
    while true do
        serverLabel.Text = "Server: " .. (game.JobId == "" and "Lobby" or string.sub(game.JobId, 1, 8) .. "...")
        wait(3)
    end
end

-- Reiniciar quando o personagem respawnar
player.CharacterAdded:Connect(function()
    wait(2)
    currentTPIndex = 1
    findDragonBalls()
    
    -- Reativar Auto Execute se estiver ligado
    if AUTO_EXECUTE then
        statusLabel.Text = "üü¢ AUTO EXECUTE ON"
    end
end)

-- Auto Execute ao entrar no jogo
wait(5) -- Esperar o jogo carregar

-- Verificar se deve executar automaticamente
findDragonBalls()
if #dragonBalls > 0 then
    -- Se tem esferas, ativar ESP automaticamente
    IS_ESP_ACTIVE = true
    espButton.Text = "üåü DESLIGAR ESP"
    espButton.BackgroundColor3 = Color3.fromRGB(80, 180, 180)
    statusLabel.Text = "üü¢ AUTO ESP ATIVADO"
    findDragonBalls()
    coroutine.wrap(espLoop)()
end

-- Iniciar loops
coroutine.wrap(updateServerInfo)()

print("üåü ESP + Hop Server + Auto Execute carregado!")
print("‚ö° Script executa automaticamente ao entrar no server")
print("üîÑ Hop Server FUNCIONAL - m√©todos simples e alternativo")
print("üöÄ TP c√≠clico entre esferas encontradas")

-- Primeira execu√ß√£o
serverLabel.Text = "Server: " .. (game.JobId == "" and "Lobby" or string.sub(game.JobId, 1, 8) .. "...")